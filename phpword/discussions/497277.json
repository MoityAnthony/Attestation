[
  {
    "Id": "1165724",
    "ThreadId": "497277",
    "Html": "I'm getting this error: Fatal error: Uncaught exception 'Exception' with message 'Could not close zip file.' in /home/dyken/public_html/PHPWord/Template.php:109 Stack trace: #0 /home/dyken/public_html/lettersWord.php(40): PHPWord_Template-&gt;save('MemberLetters.d...') #1 {main} thrown in /home/dyken/public_html/PHPWord/Template.php on line 109\r<br />\n<br />\nI have this code:\r<br />\n<br />\n$sql = &quot;SELECT distinct p.person_id, fname_mi, lname, company_name, addr1, addr2, city, st, zip, greeting, email, fullName FROM person p INNER JOIN person_category c on c.person_id = p.person_id WHERE category_id = 1 order by lname, fname_mi, company_name&quot;;\r<br />\n<br />\n$result = mysqli_query($dlink,$sql);\r<br />\n<br />\nrequire_once 'PHPWord.php';\r<br />\n<br />\nwhile ($row = mysqli_fetch_array($result)) {\r<br />\n<br />\n$PHPWord = new PHPWord();\r<br />\n$document = $PHPWord-&gt;loadTemplate('letters/testLetter.docx');\r<br />\n<br />\n$document-&gt;setValue('Value1', $row[1]);\r<br />\n$document-&gt;setValue('Value2', $row[2]);\r<br />\n$document-&gt;setValue('Value3', $row[3]);\r<br />\n$document-&gt;setValue('Value4', $row[4]);\r<br />\n$document-&gt;setValue('Value5', $row[5]);\r<br />\n$document-&gt;setValue('Value6', $row[6]);\r<br />\n$document-&gt;setValue('Value7', $row[7]);\r<br />\n$document-&gt;setValue('Value8', $row[8]);\r<br />\n$document-&gt;setValue('Value9', $row[9]);\r<br />\n$document-&gt;setValue('Value10', $row[10]);\r<br />\n$document-&gt;setValue('Value11', $row[11]);\r<br />\n$file = 'MemberLetters.docx' . $row[0];\r<br />\n$document-&gt;save($file);\r<br />\n<br />\nif(!$file) {<br />\n<pre><code>// File doesn't exist, output error\ndie('file not found');</code></pre>\n\n}\r<br />\nelse {<br />\n<pre><code> header(&quot;Cache-Control: public&quot;);\nheader(&quot;Content-Description: File Transfer&quot;);\nheader(&quot;Content-Disposition: attachment; filename=$file&quot;);\nheader(&quot;Content-Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;);\nheader(&quot;Content-Transfer-Encoding: binary&quot;);\n\nreadfile($file);</code></pre>\n\n}\r<br />\n<br />\n unlink($file);\r<br />\n<br />\n exit;\r<br />\n  }\r<br />\n<br />\n<br />\n\t\r<br />\n<br />\nI'm getting this error: Fatal error: Uncaught exception 'Exception' with message 'Could not close zip file.' in /home/dyken/public_html/PHPWord/Template.php:109 Stack trace: #0 /home/dyken/public_html/lettersWord.php(40): PHPWord_Template-&gt;save('MemberLetters.d...') #1 {main} thrown in /home/dyken/public_html/PHPWord/Template.php on line 109\r<br />\n<br />\nI have this code:\r<br />\n<br />\n$sql = &quot;SELECT distinct p.person_id, fname_mi, lname, company_name, addr1, addr2, city, st, zip, greeting, email, fullName FROM person p INNER JOIN person_category c on c.person_id = p.person_id WHERE category_id = 1 order by lname, fname_mi, company_name&quot;;\r<br />\n<br />\n$result = mysqli_query($dlink,$sql);\r<br />\n<br />\nrequire_once 'PHPWord.php';\r<br />\n<br />\nwhile ($row = mysqli_fetch_array($result)) {\r<br />\n<br />\n$PHPWord = new PHPWord();\r<br />\n$document = $PHPWord-&gt;loadTemplate('letters/testLetter.docx');\r<br />\n<br />\n$document-&gt;setValue('Value1', $row[1]);\r<br />\n$document-&gt;setValue('Value2', $row[2]);\r<br />\n$document-&gt;setValue('Value3', $row[3]);\r<br />\n$document-&gt;setValue('Value4', $row[4]);\r<br />\n$document-&gt;setValue('Value5', $row[5]);\r<br />\n$document-&gt;setValue('Value6', $row[6]);\r<br />\n$document-&gt;setValue('Value7', $row[7]);\r<br />\n$document-&gt;setValue('Value8', $row[8]);\r<br />\n$document-&gt;setValue('Value9', $row[9]);\r<br />\n$document-&gt;setValue('Value10', $row[10]);\r<br />\n$document-&gt;setValue('Value11', $row[11]);\r<br />\n$file = 'MemberLetters.docx' . $row[0];\r<br />\n$document-&gt;save($file);\r<br />\n<br />\nif(!$file) {<br />\n<pre><code>// File doesn't exist, output error\ndie('file not found');</code></pre>\n\n}\r<br />\nelse {<br />\n<pre><code> header(&quot;Cache-Control: public&quot;);\nheader(&quot;Content-Description: File Transfer&quot;);\nheader(&quot;Content-Disposition: attachment; filename=$file&quot;);\nheader(&quot;Content-Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;);\nheader(&quot;Content-Transfer-Encoding: binary&quot;);\n\nreadfile($file);</code></pre>\n\n}\r<br />\n<br />\n unlink($file);\r<br />\n<br />\n exit;\r<br />\n  }\r<br />\n<br />\ntestLetter.docx contains this:\r<br />\n<br />\n${Value1} ${Value2}\r<br />\n${Value3}\r<br />\n${Value4}\r<br />\n${Value5}\r<br />\n${Value6}, ${Value7} ${Value8}\r<br />\n<br />\nI cannot get the query to populate the Values in the letter.\r<br />\n<br />\nThe query produces results elsewhere in the website, so I know that works.\r<br />\n<br />\n$dlink is my $host, $user, $password and $dbname connection\r<br />\n<br />\nI am getting documents in the letters folder, but not as many as I expect and they are all exact copies of testLetter.docx with the ${Value1}, etc. and not the data from my query.\r<br />\n<br />\nI have tried different variations of the code, but I can never get any of my query results in place of the $Values. Can someone please help me with this? I'm new to PHPWord.<br />\n",
    "PostedDate": "2014-01-14T10:00:44.483-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]