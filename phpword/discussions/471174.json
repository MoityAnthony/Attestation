[
  {
    "Id": "1129106",
    "ThreadId": "471174",
    "Html": "Hi there,\r<br />\n<br />\nI am using CodeIgnitor and PHPWord for an application that outputs a few reports.\r<br />\n<br />\nEverything is working well but I realise that I am not strictly following the MVC pattern as when I am using PHPWord to output a report, the content of the word document is being added in the controller when it should be the view.\r<br />\n<br />\nHere is the code for the function outputting the word report.  It is within the reports controller fiel: reports.php\r<br />\n<br />\nSo if I understand correctly all the calls to the addText() function should be made from the view file, is that correct? Any tips on how to move these calls into a &quot;view&quot;?<br />\n<pre><code>function print_inspection_word() {\n                $this-&gt;load-&gt;model('report_model');\n                $data['buildingdetails'] = $this-&gt;report_model-&gt;getBuildingDetails($this-&gt;uri-&gt;segment(3),$this-&gt;uri-&gt;segment(4),$this-&gt;uri-&gt;segment(5),$this-&gt;uri-&gt;segment(6));\n                $data['buildinghazards'] = $this-&gt;report_model-&gt;getBuildingHazards($this-&gt;uri-&gt;segment(5));\n                $companyName = &quot;&quot;;\n                foreach($data['buildingdetails'] as $detail){\n                    $companyName = $detail-&gt;company;\n                }\n\n                $this-&gt;load-&gt;model('group_model');\n                $data['company_types'] = $this-&gt;group_model-&gt;getCompany_type();\n                $data['countries'] = $this-&gt;group_model-&gt;getCountries();\n                \n                $this-&gt;load-&gt;model('hazard_model');\n                $data['hazard_levels'] = $this-&gt;hazard_model-&gt;getHazardLevels();\n                \n                $data['load_header'] = false;\n                $data['load_footer'] = false;\n                $data['main_content'] = 'print_inspection';\n                $data['message'] = &quot;&quot;;\n                $data['message_type'] = &quot;&quot;;\n                $data['page_title'] = &quot;Building Inspection Report&quot;;\n                $data['body_class'] = &quot;reports&quot;;\n\n                //our docx will have 'lanscape' paper orientation\n                $section = $this-&gt;word-&gt;createSection(array('orientation'=&gt;'portrait'));\n                // Add text elements\n                $section-&gt;addText(&quot;&quot;);\n                // Define table style arrays\n                //$styleTable = array('borderSize'=&gt;0, 'borderColor'=&gt;'000000', 'cellMargin'=&gt;80);\n                $styleTable = array();\n                //$styleFirstRow = array('borderBottomSize'=&gt;18, 'borderBottomColor'=&gt;'0000FF', 'bgColor'=&gt;'66BBFF');\n                \n                // Define cell style arrays\n                $styleCell = array('valign'=&gt;'center');\n                $styleCellBTLR = array('valign'=&gt;'center', 'textDirection'=&gt;PHPWord_Style_Cell::TEXT_DIR_BTLR);\n \n                // Define font style for first row\n                $fontStyle = array('bold'=&gt;true, 'align'=&gt;'center');\n                $frontPageFontStyle = array('bold'=&gt;false, 'size'=&gt;18, 'align'=&gt;'center');\n                $headingFontStyle = array('bold'=&gt;true, 'size'=&gt;18, 'align'=&gt;'center');\n                $subHeadingFontStyle = array('bold'=&gt;true, 'underline'=&gt; PHPWord_Style_Font::UNDERLINE_SINGLE, 'align'=&gt;'center');\n                // Add table style\n                $this-&gt;word-&gt;addTableStyle('myOwnTableStyle', $styleTable);\n                foreach($data['buildingdetails'] as $detail){\n                    $companyType = '';\n                    foreach($data['company_types'] as $type) {\n                        if($type-&gt;id == $detail-&gt;company_type) {\n                            $companyType =  $type-&gt;company_type;\n                        }\n                    }\n                    $countryName = '';\n                    foreach($data['countries'] as $country) {\n                        if($country-&gt;id == $detail-&gt;country) {\n                            $countryName =  $country-&gt;name;\n                        }\n                    }\n                    $constructionDate = date( 'F', mktime(0, 0, 0, $detail-&gt;month_contructed) ).&quot; &quot;.$detail-&gt;year_constructed;\n                    $inspectionResult = '';\n                    if($detail-&gt;status == 1) {\n                         $inspectionResult =  &quot;Pass&quot;;\n                    } \n                    else {\n                         $inspectionResult =  &quot;Fail&quot;;\n                    }\n                    \n                    $section-&gt;addText($detail-&gt;buildingname, $headingFontStyle);\n                    $section-&gt;addText(&quot;&quot;,$fontStyle);\n                    $section-&gt;addText(&quot;Company Details&quot;,$subHeadingFontStyle);\n                    $section-&gt;addText('Company/Owner Name: ', $fontStyle);\n                    $section-&gt;addText($detail-&gt;company);\n                    $section-&gt;addText('Company Type: ', $fontStyle);\n                    $section-&gt;addText($companyType);\n                    $section-&gt;addText('Address: ', $fontStyle);\n                    $section-&gt;addText($detail-&gt;address_line_1);\n                    if($detail-&gt;address_line_2 != &quot;&quot;){\n                        $section-&gt;addText($detail-&gt;address_line_2);\n                    }\n                    $section-&gt;addText('Suburb: ', $fontStyle);\n                    $section-&gt;addText($detail-&gt;suburb);\n                    $section-&gt;addText('City: ', $fontStyle);\n                    $section-&gt;addText($detail-&gt;city);\n                    $section-&gt;addText('Country: ', $fontStyle);\n                    $section-&gt;addText($countryName); \n                    $section-&gt;addText('Phone: ', $fontStyle);\n                    $section-&gt;addText($detail-&gt;phone);\n                    $section-&gt;addText('E Mail: ', $fontStyle);\n                    $section-&gt;addText($detail-&gt;email);\n                    $section-&gt;addText(&quot;&quot;,$fontStyle);\n$filename='report.docx'; //save our document as this file name\n                header('Content-Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document'); //mime type\n                header('Content-Disposition: attachment;filename=&quot;'.$filename.'&quot;'); //tell browser what's the file name\n                header('Cache-Control: max-age=0'); //no cache\n                $objWriter = PHPWord_IOFactory::createWriter($this-&gt;word, 'Word2007');\n                $objWriter-&gt;save('php://output');\n\n                exit;\n}</code></pre>\n\n",
    "PostedDate": "2013-11-26T02:45:06.697-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]